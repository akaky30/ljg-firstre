# 明天启动项目完整流程

假设你的项目路径是：

```
C:\Users\李建国\Desktop\bs2
```

## 1️⃣ 打开命令行并进入项目目录

```
cd C:\Users\李建国\Desktop\bs2
```

## 2️⃣ 激活虚拟环境

Windows：

```
venv\Scripts\activate
```

激活成功后，你会看到 `(venv)` 前缀。

> ⚠️ 注意：**必须激活虚拟环境**，否则系统会用全局 Python，依赖可能不匹配。

## 3️⃣ 启动 Flask 后端（接收 mitmproxy 会话）

```
python app.py
```

- 确认 Flask 在控制台显示类似：

```
 * Running on http://0.0.0.0:5000
```

- 0.0.0.0 表示允许局域网设备访问。
- 如果 Flask 报端口被占用，修改 `app.py` 中 `port` 或杀掉占用进程。

## 4️⃣ 打开另一个终端（或者另一个 CMD 窗口）进入项目目录并激活虚拟环境

```
cd C:\Users\李建国\Desktop\bs2
venv\Scripts\activate
```

## 5️⃣ 启动 mitmproxy 并运行你的脚本

```
mitmdump -s mitm_to_flask.py --listen-host 0.0.0.0 -p 8080
```

- `--listen-host 0.0.0.0`：允许手机/模拟器访问代理。
- `-p 8080`：端口号，可按需修改。
- 控制台显示 `Proxy server listening at 0.0.0.0:8080` 即表示成功启动。

## 6️⃣ 手机/模拟器代理设置

1. 手机 Wi-Fi → 手动代理 → 主机填你电脑的 IP，端口填 8080。
2. HTTPS 测试：手机浏览器访问 `http://mitm.it` → 安装 mitmproxy 根证书。

> ⚠️ Android ≥7 或带 certificate pinning 的 App，需要模拟器/root 测试或特殊方式才能抓 HTTPS。

## 7️⃣ 测试流程

- 打开手机浏览器或 App 发请求，mitmdump 控制台会显示请求日志。
- Flask 控制台会显示收到的 POST 数据。
- 在浏览器访问 `http://你的电脑IP:5000/api/sessions` 可查看已存会话。

------

# ⚡ 常见注意事项

1. **顺序很重要**：
   - 先激活虚拟环境 → 先启动 Flask → 再启动 mitmproxy。
2. **虚拟环境必须激活**。
3. **不要升级 mitmproxy、cryptography、pyOpenSSL 或 brotli**，保持现在的版本。
4. **端口冲突**：Flask 默认 5000，mitmproxy 默认 8080，可改端口但需同步修改脚本和代理设置。
5. **防火墙**：第一次运行要允许端口入站访问，否则手机/模拟器无法连上。