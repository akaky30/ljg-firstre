​			

**app.py**

- app.py (lines 386-404) – 新增 FRIDA_CLI_PROCS 与互斥锁，专门记录通过 CLI 启动的 Frida 子进程句柄（pid -> {"proc": Popen, "script": path}），为之后的安全停止与状态同步奠定数据结构。
- app.py (lines 452-512) – _start_frida_via_subprocess 现在用 stdin=PIPE 启动 Frida CLI，并把进程保存到上面的字典；并行启动 reader_thread 读取 stdout/stderr，另起 wait_thread 等待子进程退出后发出 frida_stopped 事件并清理字典，避免僵尸进程或前端状态失真。
- app.py (lines 706-754) – run_frida 只在显式传入模板或脚本时组装用户脚本，去掉了根据会话内容自动推断脚本的旧逻辑，防止无意识的重复注入；同时命名生成脚本时改用 template_name。
- app.py (lines 915-950) – 新增 /api/exit_frida_cli：校验 PID → 在 FRIDA_CLI_PROCS 中查找进程 → 向 stdin 写入 exit\n 并刷新；若 PID 未被追踪、进程已结束或写入失败，会返回对应错误与日志，支撑前端的“结束进程”功能。

**index.html**

- index.html (lines 320-328) – 删除会话详情右上角“脚本下载”“运行”“Spawn”控件，界面改为仅展示详情。
- index.html (lines 365-368) 与 397-399 – 在模板面板与自定义脚本面板中新增“结束模板进程”“结束脚本进程”按钮，配合后端新接口一键退出。
- index.html (lines 447-520) – 新增 lastTemplatePid/lastCustomPid 状态与 requestFridaExit 工具函数：向 /api/exit_frida_cli 发送退出请求、写日志、成功后执行回调清空 PID，失败时弹框提示；socket.on("frida_stopped") 也会统一清理状态。
- index.html (lines 523-528) – 调整 frida_log 事件，将日志写入当前会话缓冲后只在 sid !== GLOBAL_ID 时再写一次全局缓冲，解决 CLI 输出在控制台重复的问题。
- index.html (lines 647-676) – 模板执行逻辑记录最新 CLI PID 到 lastTemplatePid，异常或失败时清空；新增 stopMemBtn 点击处理调用 requestFridaExit 并重置。
- index.html (lines 718-744) – 自定义脚本注入同样记录/清空 PID，错误时复位；stopCustomBtn 调用同一个退出工具。

整体效果：前端 UI 与后端 API 均支持安全终止 Frida CLI 会话、控制台不再重复输出；原先的下载/运行按钮被移除，避免旧逻辑误触。